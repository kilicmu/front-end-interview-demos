# 应用层

### 常见应用层协议：

* DNS协议 -> TCP/IP -> 58
* FTP -> TCP -> 20(文件传输) / 21(传输控制)
* DHCP -> UDP -> 68(服务端) / 67(客户端)
* TELNET  -> TCP -> 23
* SMTP（-> TCP -> 25）\POP3( -> TCP -> 110) &IMAP( -> TCP -> 143)

### 说说DNS

#### 概念：

DNS是一个分布式的数据库，用来提供对IP地址与主机名之间的转换。

分为根域名、顶级域名、二级域名。

#### 问题：

##### 1. dns服务使用了什么传输协议？

大部分使用UDP，少数时候使用TCP

##### 2. 为什么这么使用UDP

大部分的DNS查询数据包很小（约15-75字节），如果使用TCP传输经计算会有下面的问题：

1. tcp链接的建立会进行三次网络通信
2. 建立一个tcp链接需要传输约130个字节数据
3. 销毁tcp链接需要四次网络通信
4. 销毁需要传输160个左右字节

建立tcp链接传输的字节数都已经大于数据包的大小，同时考虑到目标DNS服务器不存在DNS解析记录会向根服务器递归查询，会造成严重的网络资源浪费与性能问题。

##### 3. 什么时候使用TCP？

当传输数据量大时我们需要使用TCP保证DNS服务的稳定性。

当单个数据包的大小达到一个最大传输单元（MTU），在数据链路层会对UDP数据包进行分帧传输，会造成数据的丢帧。

这时候就需要用TCP解决这个问题。
并且数据量增大，TCP链接的额外开销便会减小。

### 说说DHCP

DHCP (Dynamic Host Configuration Protocol) 提供了即插即用的连网方式，用户不再需要手动配置 IP 地址等信息。

#### 问题：

##### 1.DHCP工作流程：

1. 客户端发送Discover报文（0.0.0.0:68 -> 255.255.255.255:67）放入UDP中。
2. DHCP服务器收到报文后，发送Offer给客户端，其中包含有客户端需要的信息。
3. 客户端选择一个DHCP服务器提供的信息，发送Request给DHCP服务器
4. DHCP服务器发送ACK报文，标识客户端可以使用提供的信息

